name: tf-app
env:
  TERRAFORM_BASE_PATH: 'ci/infra/terraform/'

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  apply-layer3:
    # if: ${{ inputs.TRIGGER_EVENT == 'push' }}
    runs-on: ubuntu-latest
    name: deploy
    env:
      LAYER_NAME: layer-3
      
        
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: TF-Apply
        env:
          GOOGLE_APPLICATION_CREDENTIALS: ${{ github.workspace }}/sample-app/nowwilltrymore-c1e2afe68da3.json
        uses: dflook/terraform-apply@v1.22.1
        with:
          auto_approve: true
          path: ${{ env.TERRAFORM_BASE_PATH }}/${{ env.LAYER_NAME }}
          backend_config: bucket=statestore-eu-first, prefix=layer-3-app-deveun.tfstate

      
